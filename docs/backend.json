{
  "entities": {
    "Family": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Family",
      "type": "object",
      "description": "Represents a family unit that tracks their combined financial data.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Family entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the family."
        },
        "createdAt": {
          "type": "string",
          "description": "Date and time when the family record was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "createdAt"
      ]
    },
    "Income": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Income",
      "type": "object",
      "description": "Represents a source of income for the family.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Income entity."
        },
        "familyId": {
          "type": "string",
          "description": "Reference to Family. (Relationship: Family 1:N Income)"
        },
        "source": {
          "type": "string",
          "description": "The source of the income (e.g., salary, investment)."
        },
        "amount": {
          "type": "number",
          "description": "The amount of income received."
        },
        "date": {
          "type": "string",
          "description": "The date the income was received.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "A description of the income."
        }
      },
      "required": [
        "id",
        "familyId",
        "source",
        "amount",
        "date"
      ]
    },
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents an expense incurred by the family.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Expense entity."
        },
        "familyId": {
          "type": "string",
          "description": "Reference to Family. (Relationship: Family 1:N Expense)"
        },
        "category": {
          "type": "string",
          "description": "The category of the expense (e.g., rent, food, entertainment)."
        },
        "amount": {
          "type": "number",
          "description": "The amount of the expense."
        },
        "date": {
          "type": "string",
          "description": "The date the expense was incurred.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "A description of the expense."
        }
      },
      "required": [
        "id",
        "familyId",
        "category",
        "amount",
        "date"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/families/{familyId}",
        "definition": {
          "entityName": "Family",
          "schema": {
            "$ref": "#/backend/entities/Family"
          },
          "description": "Stores family data. Includes denormalized 'familyId' for authorization independence.",
          "params": [
            {
              "name": "familyId",
              "description": "The unique identifier for the family."
            }
          ]
        }
      },
      {
        "path": "/families/{familyId}/incomes/{incomeId}",
        "definition": {
          "entityName": "Income",
          "schema": {
            "$ref": "#/backend/entities/Income"
          },
          "description": "Stores income data for a specific family. Includes denormalized 'familyId' for authorization independence.",
          "params": [
            {
              "name": "familyId",
              "description": "The unique identifier for the family."
            },
            {
              "name": "incomeId",
              "description": "The unique identifier for the income record."
            }
          ]
        }
      },
      {
        "path": "/families/{familyId}/expenses/{expenseId}",
        "definition": {
          "entityName": "Expense",
          "schema": {
            "$ref": "#/backend/entities/Expense"
          },
          "description": "Stores expense data for a specific family. Includes denormalized 'familyId' for authorization independence.",
          "params": [
            {
              "name": "familyId",
              "description": "The unique identifier for the family."
            },
            {
              "name": "expenseId",
              "description": "The unique identifier for the expense record."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and ease of debugging, following the principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs. Authorization Independence is achieved through denormalization. Specifically, the `familyId` is copied into `incomes` and `expenses`, removing the need for `get()` calls in security rules and enabling atomic operations. Structural Segregation is maintained by dedicating collections to distinct data types (`families`, `incomes`, `expenses`). Access Modeling standardizes authorization, with user-owned data residing under the `/families/{familyId}` path, and collaborative data utilizing the membership map pattern (although a membership map isn't explicitly implemented here, the `familyId` serves a similar purpose). QAPs are supported through structural segregation, allowing secure listing of resources within a family's scope. Finally, invariants such as ownership and timestamps can be readily enforced using this structure.\n\nSpecifically:\n*   The `families` collection stores family-level data.\n*   The `families/{familyId}/incomes` subcollection stores income records associated with a specific family. The `familyId` is denormalized to maintain authorization independence.\n*   The `families/{familyId}/expenses` subcollection stores expense records associated with a specific family. The `familyId` is denormalized to maintain authorization independence."
  }
}